<div class="painel-aluno-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1>Meu Painel de Estudos</h1>
      <p>Bem-vindo, {{ authService.userName() }}!</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button (click)="goToHome()">
        <mat-icon>home</mat-icon>
        Início
      </button>
      <button mat-raised-button color="warn" (click)="logout()">
        <mat-icon>logout</mat-icon>
        Sair
      </button>
    </div>
  </header>

  <!-- Loading -->
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Carregando seus cursos...</p>
    </div>
  }

  <!-- Error -->
  @if (error()) {
    <div class="error-container">
      <mat-icon color="warn">error</mat-icon>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="loadCourses()">
        Tentar Novamente
      </button>
    </div>
  }

  <!-- Content -->
  @if (!isLoading() && !error()) {
    <div class="content">
      <!-- Cursos em Andamento -->
      <section class="courses-section">
        <h2>
          <mat-icon>play_circle</mat-icon>
          Cursos em Andamento ({{ coursesInProgress().length }})
        </h2>

        @if (coursesInProgress().length === 0) {
          <p class="empty-message">Você ainda não começou nenhum curso.</p>
        } @else {
          <div class="courses-grid">
            @for (item of coursesInProgress(); track item.course.id) {
              <mat-card class="course-card">
                <mat-card-header>
                  <mat-card-title>{{ item.course.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip-set>
                      @for (cat of item.course.categories; track cat.id) {
                        <mat-chip>{{ cat.name }}</mat-chip>
                      }
                    </mat-chip-set>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <p>{{ item.course.description }}</p>

                  <div class="progress-info">
                    <span>Progresso: {{ item.progress }}%</span>
                    <mat-progress-bar
                      mode="determinate"
                      [value]="item.progress">
                    </mat-progress-bar>
                  </div>

                  <div class="course-info">
                    <span>
                      <mat-icon>schedule</mat-icon>
                      {{ item.course.workload }}h
                    </span>
                    <span>
                      <mat-icon>school</mat-icon>
                      {{ item.course.instructors[0]?.name }}
                    </span>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="goToCourse(item.course.id)">
                    Continuar
                  </button>
                </mat-card-actions>
              </mat-card>
            }
          </div>
        }
      </section>

      <!-- Cursos Não Iniciados -->
      <section class="courses-section">
        <h2>
          <mat-icon>book</mat-icon>
          Meus Cursos ({{ coursesNotStarted().length }})
        </h2>

        @if (coursesNotStarted().length === 0) {
          <p class="empty-message">Você não tem cursos pendentes.</p>
        } @else {
          <div class="courses-grid">
            @for (item of coursesNotStarted(); track item.course.id) {
              <mat-card class="course-card">
                <mat-card-header>
                  <mat-card-title>{{ item.course.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip-set>
                      @for (cat of item.course.categories; track cat.id) {
                        <mat-chip>{{ cat.name }}</mat-chip>
                      }
                    </mat-chip-set>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <p>{{ item.course.description }}</p>

                  <div class="course-info">
                    <span>
                      <mat-icon>schedule</mat-icon>
                      {{ item.course.workload }}h
                    </span>
                    <span>
                      <mat-icon>school</mat-icon>
                      {{ item.course.instructors[0]?.name }}
                    </span>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button
                    mat-raised-button
                    color="accent"
                    (click)="goToCourse(item.course.id)">
                    Começar Agora
                  </button>
                </mat-card-actions>
              </mat-card>
            }
          </div>
        }
      </section>

      <!-- Cursos Concluídos -->
      <section class="courses-section">
        <h2>
          <mat-icon>check_circle</mat-icon>
          Cursos Concluídos ({{ coursesCompleted().length }})
        </h2>

        @if (coursesCompleted().length === 0) {
          <p class="empty-message">Você ainda não concluiu nenhum curso.</p>
        } @else {
          <div class="courses-grid">
            @for (item of coursesCompleted(); track item.course.id) {
              <mat-card class="course-card completed">
                <mat-card-header>
                  <mat-card-title>
                    {{ item.course.title }}
                    <mat-icon class="completed-icon">verified</mat-icon>
                  </mat-card-title>
                  <mat-card-subtitle>
                    <mat-chip-set>
                      @for (cat of item.course.categories; track cat.id) {
                        <mat-chip>{{ cat.name }}</mat-chip>
                      }
                    </mat-chip-set>
                  </mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <p>{{ item.course.description }}</p>

                  <div class="course-info">
                    <span>
                      <mat-icon>schedule</mat-icon>
                      {{ item.course.workload }}h
                    </span>
                    <span>
                      <mat-icon>event</mat-icon>
                      
                    </span>
                  </div>
                </mat-card-content>

                <mat-card-actions>
                  <button
                    mat-raised-button
                    (click)="goToCourse(item.course.id)">
                    Revisar
                  </button>
                </mat-card-actions>
              </mat-card>
            }
          </div>
        }
      </section>
    </div>
  }
</div>
